{% load static %}

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Выбор чемпиона</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(25, 25, 35, 0.95);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.1);
      color: #e0e0e0;
    }

    h1 {
      text-align: center;
      color: #fff;
      margin-bottom: 25px;
      font-size: 2.5rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      background: linear-gradient(45deg, #4facfe, #00f2fe);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    #timer-container {
      text-align: center;
      margin-bottom: 20px;
    }

    #timer {
      font-size: 28px;
      font-weight: bold;
      color: #ff6b6b;
      padding: 15px 25px;
      background: rgba(255, 107, 107, 0.15);
      border-radius: 12px;
      display: inline-block;
      border: 2px solid rgba(255, 107, 107, 0.3);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }

    #current-turn {
      text-align: center;
      font-size: 18px;
      color: #ffd700;
      margin-bottom: 25px;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .teams-container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 25px;
      gap: 30px;
    }

    .team-column {
      flex: 1;
      min-width: 220px;
      background: rgba(30, 30, 40, 0.7);
      padding: 20px;
      border-radius: 15px;
      border: 2px solid transparent;
    }

    .blue-team {
      border-color: rgba(79, 175, 255, 0.4);
      box-shadow: 0 0 15px rgba(79, 175, 255, 0.2);
    }

    .red-team {
      border-color: rgba(255, 107, 107, 0.4);
      box-shadow: 0 0 15px rgba(255, 107, 107, 0.2);
    }

    .team-title {
      font-weight: bold;
      margin-bottom: 15px;
      text-align: center;
      font-size: 1.4rem;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .blue-team .team-title {
      color: #4facfe;
    }

    .red-team .team-title {
      color: #ff6b6b;
    }

    .bans-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 15px;
    }

    .ban-cell {
      width: 70px;
      height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      gap: 4px;
      padding: 5px 0;
    }

    .ban-cell img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
    }

    .ban-cell .champion-name {
      font-size: 10px;
      color: #fff;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 65px;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    /* .blue-team .ban-cell {
      border-color: #4facfe;
      background: rgba(79, 175, 255, 0.15);
    }

    .red-team .ban-cell {
      border-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.15);
    } */

    .main-game-area {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 25px;
      margin-bottom: 25px;
    }

    .picks-column {
      display: flex;
      flex-direction: column;
      gap: 15px;
      min-width: 110px;
    }

    .pick-cell {
      width: 90px;
      height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      gap: 5px;
      padding: 5px 0;
    }

    .pick-cell img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
    }

    .pick-cell .champion-name {
      font-size: 11px;
      color: #e0e0e0;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 85px;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }


    .blue-picks-column .pick-cell {
      border-color: #4facfe;
      background: rgba(79, 175, 255, 0.2);
    }

    .red-picks-column .pick-cell {
      border-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.2);
    }

    /* Role selector styles */
    .role-selector {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .role-btn {
      padding: 8px 16px;
      background: rgba(50, 50, 60, 0.8);
      border: 2px solid #555;
      border-radius: 25px;
      color: #e0e0e0;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .role-btn:hover {
      background: rgba(79, 175, 255, 0.3);
      border-color: #4facfe;
      transform: translateY(-2px);
    }

    .role-btn.active {
      background: linear-gradient(45deg, #4facfe, #00f2fe);
      color: #1a1a2e;
      border-color: #4facfe;
      box-shadow: 0 4px 15px rgba(79, 175, 255, 0.4);
    }

    #champions-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      flex: 1;
      min-width: 450px;
      background: rgba(35, 35, 45, 0.7);
      padding: 20px;
      border-radius: 15px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      max-height: 400px;
      overflow-y: auto;
    }


    .champion-cell {
      width: 90px;
      height: 120px; /* Увеличили высоту для текста */
      border: 3px solid #444;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: rgba(40, 40, 50, 0.8);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      padding: 0;
      margin: 0;
      gap: 5px;
    }

    .champion-cell img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      transition: transform 0.2s ease;
      margin-top: 5px;
    }

    .champion-cell .champion-name {
      font-size: 12px;
      color: #e0e0e0;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 80px;
      font-weight: bold;
      margin: 0 5px 5px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    .champion-cell:hover {
      transform: scale(1.05);
      border-color: #888;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .champion-cell input[type="radio"] {
      position: absolute;
      opacity: 0;
      z-index: -1;
    }

    .champion-cell input[type="radio"]:checked + img,
    .champion-cell input[type="radio"]:checked ~ .champion-name {
      border: 2px solid #00c9ff;
      box-shadow: 0 0 15px rgba(0, 201, 255, 0.6);
    }

    .champion-cell input[type="radio"]:checked {
      outline: none;
    }

    /* Для мобильных устройств */
    @media (max-width: 768px) {
      .champion-cell {
        width: 70px;
        height: 100px;
      }
      .champion-cell img {
        width: 60px;
        height: 60px;
        border-radius: 6px;
      }
      .champion-cell .champion-name {
        font-size: 10px;
        max-width: 60px;
      }
    }


    .buttons-container {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 25px;
    }

    .btn {
      padding: 14px 32px;
      font-size: 18px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: bold;
      letter-spacing: 1px;
      text-transform: uppercase;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    #confirm-btn {
      background: linear-gradient(45deg, #00c9ff, #92fe9d);
      color: #1a1a2e;
    }

    #confirm-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 201, 255, 0.5);
    }

    #ban-btn {
      background: linear-gradient(45deg, #ff6b6b, #ff8e53);
      color: white;
    }

    #ban-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.5);
    }

    #result {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
      color: #4caf50;
      text-align: center;
      min-height: 28px;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    .time-expired {
      background: rgba(255, 107, 107, 0.25) !important;
      color: #ff1744 !important;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 23, 68, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(255, 23, 68, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 23, 68, 0); }
    }

    .your-turn {
      color: #4caf50;
      font-style: italic;
      animation: glow 2s infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 0 0 5px #4caf50; }
      to { text-shadow: 0 0 20px #4caf50, 0 0 30px #4caf50; }
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(30, 30, 40, 0.5);
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(45deg, #4facfe, #00f2fe);
      border-radius: 4px;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .teams-container {
        flex-direction: column;
        gap: 20px;
      }
      
      .main-game-area {
        flex-direction: column;
        gap: 20px;
      }
      
      .picks-column {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        min-width: auto;
      }
      
      .pick-cell {
        width: 70px;
        height: 70px;
        font-size: 10px;
      }
      
      .champion-cell {
        flex-direction: column;
        padding: 5px;
        gap: 6px;
      }

      .champion-cell img {
        width: 60px;
        height: 60px;
        object-fit: contain;
        background: rgba(0,0,0,0.2);
        border-radius: 8px;
      }

      .champion-cell input[type="radio"]:checked + img {
        border: 2px solid #00c9ff;
        box-shadow: 0 0 10px rgba(0, 201, 255, 0.6);
      }
      
      .role-btn {
        padding: 6px 12px;
        font-size: 12px;
      }
      
      #champions-container {
        min-width: auto;
        max-height: 300px;
      }
    }
    .search-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    #champion-search {
      width: 300px;
      padding: 12px 20px;
      font-size: 16px;
      border: 2px solid #444;
      border-radius: 50px;
      background: rgba(30, 30, 40, 0.8);
      color: #e0e0e0;
      outline: none;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    #champion-search:focus {
      border-color: #4facfe;
      box-shadow: 0 0 15px rgba(79, 175, 255, 0.3);
    }

    #champion-search::placeholder {
      color: #888;
    }
    #currentPhase {
      font-size: 1.3rem;
      font-weight: 600;
      color: #f8f9fa;
      background: linear-gradient(45deg, #1a1a2e, #16213e);
      padding: 12px 20px;
      border-radius: 10px;
      text-align: center;
      margin: 20px auto;
      max-width: 400px;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.05);
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
  }

    /* Неоновый эффект при изменении */
    #currentPhase::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
        z-index: -1;
        border-radius: 10px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    #currentPhase:hover::before {
        opacity: 1;
    }

    /* Анимация при обновлении (опционально) */
    @keyframes pulseGlow {
        0% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.1); }
        50% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.3); }
        100% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.1); }
    }

    #currentPhase.animate {
        animation: pulseGlow 0.8s ease-in-out;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><i class="fas fa-crown"></i> Выбор чемпиона</h1>
    
    <div id="timer-container">
      <div id="timer">Время: 30 секунд</div>
    </div>
    
    <div id="current-turn">Текущий ход: ожидание...</div>
    <div id="currentPhase"></div>
    <div class="teams-container">
      <div class="team-column blue-team">
        <div class="team-title"><i class="fas fa-shield-alt"></i> Синие</div>
        <div class="bans-list" id="blue-bans"></div>
      </div>
      
      <div class="team-column red-team">
        <div class="team-title"><i class="fas fa-fire"></i> Красные</div>
        <div class="bans-list" id="red-bans"></div>
      </div>
    </div>

    <!-- Role Selector -->
    <div class="search-container">
      <input type="text" id="champion-search" placeholder="Поиск чемпиона..." autocomplete="off">
    </div>

    <div class="main-game-area">
      <div class="picks-column blue-picks-column" id="blue-picks"></div>
      
      <div id="champions-container">
        {% for item in champion_data %}
          <label class="champion-cell" data-name="{{ item.name }}">
            <input type="radio" name="champion" value="{{ item.name }}" style="display:none;">
            <img src="{{ item.icon_url }}" alt="{{ item.name }}" loading="lazy"
                onerror="this.style.display='none'; this.nextElementSibling.textContent='{{ item.name }}';">
            <span class="champion-name">{{ item.name }}</span>
          </label>
        {% endfor %}
      </div>
      
      <div class="picks-column red-picks-column" id="red-picks"></div>
    </div>

    <div class="buttons-container">
      <button id="confirm-btn" class="btn"><i class="fas fa-check-circle"></i> Подтвердить</button>
    </div>
    
    <div id="result"></div>
  </div>

 <script>
  let allChampions = []; // [{name, icon_url}, ...]
  let selectedChampion = null;

  // === ЗАГРУЗКА ЧЕМПИОНОВ ===
  async function loadChampions() {
    try {
      const response = await fetch('/allchampions/');
      if (!response.ok) throw new Error('Сервер вернул ошибку');
      const data = await response.json();
      allChampions = Array.isArray(data.data) ? data.data : [];
      console.log("Загружено чемпионов:", allChampions.length);
      renderChampionList(allChampions);
    } catch (error) {
      console.error("Ошибка загрузки чемпионов:", error);
      document.getElementById("champions-container").innerHTML = 
        '<p style="color:#ff6b6b; text-align:center;">Не удалось загрузить чемпионов</p>';
    }
  }

  // === ОТРИСОВКА СПИСКА ===
  function renderChampionList(champions) {
    const container = document.getElementById("champions-container");
    if (!container) return;

    container.innerHTML = '';

    if (!champions || champions.length === 0) {
      container.innerHTML = '<p style="color:#888; text-align:center;">Нет совпадений</p>';
      return;
    }

    champions.forEach(champ => {
      const cell = document.createElement("label");
      cell.classList.add("champion-cell");
      cell.title = champ.name;

      const input = document.createElement("input");
      input.type = "radio";
      input.name = "champion";
      input.value = champ.name;
      input.style.display = "none";

      const img = document.createElement("img");
      img.src = champ.icon_url; // ← берём URL из объекта
      img.alt = champ.name;
      img.loading = "lazy";
      img.onerror = () => {
        img.style.display = 'none';
        nameSpan.textContent = champ.name;
      };

      const nameSpan = document.createElement("span");
      nameSpan.className = "champion-name";
      nameSpan.textContent = champ.name;

      cell.appendChild(input);
      cell.appendChild(img);
      cell.appendChild(nameSpan);
      container.appendChild(cell);
    });
  }

  // === ВЫБОР ЧЕМПИОНА ===
  document.addEventListener('change', (e) => {
    if (e.target.name === 'champion') {
      selectedChampion = e.target.value;
    }
  });

  // === ИНИЦИАЛИЗАЦИЯ ===
  document.addEventListener("DOMContentLoaded", () => {
    loadChampions();

    const searchInput = document.getElementById("champion-search");
    if (searchInput) {
      searchInput.addEventListener("input", (e) => {
        const query = e.target.value.trim().toLowerCase();
        const filtered = query
          ? allChampions.filter(champ => 
              typeof champ.name === 'string' && 
              champ.name.toLowerCase().includes(query)
            )
          : allChampions;
        renderChampionList(filtered);
      });
    }
  });

  // === ОСТАЛЬНОЙ КОД (таймер, отправка и т.д.) ===
  const roomID = window.location.pathname.split('/')[2];
  const timerElement = document.getElementById("timer");
  const currentTurnElement = document.getElementById("current-turn");
  const blueBansElement = document.getElementById("blue-bans");
  const redBansElement = document.getElementById("red-bans");
  const bluePicksElement = document.getElementById("blue-picks");
  const redPicksElement = document.getElementById("red-picks");
  
  let timeLeft = 30;
  let timerInterval = null;
  let currentTurn = null;
  let gameStatus = null;
  let blueBans = [];
  let redBans = [];
  let bluePicks = [];
  let redPicks = [];

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  async function SendChoice(champName) {
    try {
      const userUID = localStorage.getItem('user_uid');
      if (!userUID) {
        document.getElementById("result").textContent = "Ошибка: пользователь не авторизован!";
        return;
      }

      const allUsedChampions = [...blueBans, ...redBans, ...bluePicks, ...redPicks];
      if (allUsedChampions.includes(champName)) {
        document.getElementById("result").textContent = "Этот чемпион уже забанен или выбран!";
        return;
      }

      if (currentTurn !== userUID) {
        document.getElementById("result").textContent = "Не ваш ход!";
        return;
      }

      const response = await fetch(`/room/${roomID}/action/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({ 
          user_uid: userUID, 
          champName: champName 
        })
      });
      const data = await response.json();
      console.log("SendChoice response:", data);
      
      selectedChampion = null;
      document.querySelectorAll('input[name="champion"]').forEach(r => r.checked = false);
    } catch (error) {
      console.error("Ошибка отправки выбора:", error);
      document.getElementById("result").textContent = "Ошибка при отправке!";
    }
    pollUpdates()
  }

  function renderBans(bansList, containerElement) {
    containerElement.innerHTML = '';
    if (bansList && bansList.length > 0) {
      bansList.forEach(ban => {
        const banCell = document.createElement("div");
        banCell.classList.add("ban-cell");

        const img = document.createElement("img");
        // Для банов генерируем URL сами (так как получаем только имя)
        img.src = `/static/icons/${encodeURIComponent(ban)}.png`;
        img.alt = ban;
        img.loading = "lazy";
        img.style.width = "100%";
        img.style.height = "auto";
        img.style.borderRadius = "8px";
        img.style.objectFit = "cover";
        img.onerror = () => {
          img.style.display = 'none';
          nameSpan.textContent = ban;
        };

        const nameSpan = document.createElement("span");
        nameSpan.className = "champion-name";
        nameSpan.textContent = ban;

        banCell.appendChild(img);
        banCell.appendChild(nameSpan);
        containerElement.appendChild(banCell);
      });
    }
  }

  function renderPicks(picksList, containerElement) {
    containerElement.innerHTML = '';
    if (picksList && picksList.length > 0) {
      picksList.forEach(pick => {
        const pickCell = document.createElement("div");
        pickCell.classList.add("pick-cell");

        const img = document.createElement("img");
        img.src = `/static/icons/${encodeURIComponent(pick)}.png`;
        img.alt = pick;
        img.loading = "lazy";
        img.style.width = "100%";
        img.style.height = "auto";
        img.style.borderRadius = "8px";
        img.style.objectFit = "cover";
        img.onerror = () => {
          img.style.display = 'none';
          nameSpan.textContent = pick;
        };

        const nameSpan = document.createElement("span");
        nameSpan.className = "champion-name";
        nameSpan.textContent = pick;

        pickCell.appendChild(img);
        pickCell.appendChild(nameSpan);
        containerElement.appendChild(pickCell);
      });
    }
  }
   function updatePhase(text) {
      
  }
  function updatePhase(text) {
    if ([1, 2, 3, 4, 5, 6, 13, 14, 15, 16].includes(text)) {
      const phaseElement = document.getElementById('currentPhase');
      if (!phaseElement) return;
      phaseElement.textContent = "Фаза банов";
      phaseElement.classList.add('animate');
  } else if ([7, 8, 9, 10, 11, 12, 17, 18, 19, 20].includes(text)) {
      const phaseElement = document.getElementById('currentPhase');
      if (!phaseElement) return;

      phaseElement.textContent = "Фаза пиков";
  }
  }
  let updateInterval;
  async function pollUpdates() {
    try {
      const response = await fetch(`/room/${roomID}/update/`);
      if (!response.ok) {
        let i = parseInt(localStorage.getItem('i') || '0');
        if (i > 5) {
          clearInterval(updateInterval);
          localStorage.setItem('i', '0');
        } else {
          i++;
          localStorage.setItem('i', String(i));
        }
        return;
      }
      const data = await response.json();
      console.log("Обновление от сервера:", data);

      updateTimer(data.time);
      
      currentTurn = data.cur_Turn;
      gameStatus = data.status;
      updatePhase(data.t_ind);
      const userUID = localStorage.getItem('user_uid');
      
      if (currentTurn === userUID) {
        currentTurnElement.textContent = "Ваш ход!";
        currentTurnElement.className = "your-turn";
      } else {
        currentTurnElement.textContent = `Ход игрока: ${currentTurn || 'ожидание...'}`;
        currentTurnElement.className = "";
      }

      blueBans = data.blue_bans || [];
      redBans = data.red_bans || [];
      bluePicks = data.blue_piks || [];
      redPicks = data.red_picks || [];

      renderBans(blueBans, blueBansElement);
      renderBans(redBans, redBansElement);
      renderPicks(bluePicks, bluePicksElement);
      renderPicks(redPicks, redPicksElement);

      if (gameStatus === 'end') {
        clearInterval(updateInterval);
      }
    } catch (error) {
      console.error("Ошибка при опросе обновлений:", error);
      clearInterval(updateInterval);
    }
  }

  updateInterval = setInterval(pollUpdates, 500);

  function updateTimer(seconds) {
    if (seconds <= 0) {
      timerElement.textContent = "Время вышло!";
      timerElement.classList.add("time-expired");
    } else {
      const word = seconds === 1 ? "секунда" : (seconds < 5 ? "секунды" : "секунд");
      timerElement.textContent = `Время: ${seconds} ${word}`;
      timerElement.classList.remove("time-expired");
    }
  }

  document.getElementById("confirm-btn")?.addEventListener("click", () => {
    const resultDiv = document.getElementById("result");
    const userUID = localStorage.getItem('user_uid');
    
    if (!userUID) {
      resultDiv.textContent = "Ошибка: пользователь не авторизован!";
      return;
    }
    
    if (!selectedChampion) {
      resultDiv.textContent = "Сначала выберите чемпиона!";
      return;
    }

    if (currentTurn !== userUID) {
      resultDiv.textContent = "Не ваш ход!";
      return;
    }

    resultDiv.textContent = `Выбран чемпион: ${selectedChampion}`;
    SendChoice(selectedChampion);
  });
</script>
</html>

